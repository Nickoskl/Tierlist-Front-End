<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body class="body">
    <!-- <form method="post" enctype="multipart/form-data" action="http://localhost:5000/img/upload">
        <input type="file" accept=".png,.jpg" name="file">
        <button>Upload PNG or JPG up to 10 MB</button>
    </form> -->
    <!-- <img src="http://localhost:5000/img/44158.png" alt=""> -->
    <header>
        <div class="pointer header_btn">
            <img src="./icons/male-icon.svg" alt="" class="header_icon">
            <h5 class="header_btn_text">User</h5>
        </div>
        <div class="pointer header_btn">
            <img src="./icons/pencil-icon.svg" alt="" class="header_icon">
            <h5 class="header_btn_text">My lists</h5>
        </div>
        <div class="pointer header_btn">
            <img src="./icons/door-check-out-icon.svg" alt="" class="header_icon">
            <h5 class="header_btn_text">Sign in</h5>
        </div>
    </header>
    <div class="middle_title">
        <h3>TIERLIST</h3>
    </div>
    <div class="admin_menu">
        <div class="admin_menu_title">
            <h3>ADMIN MENU</h3>
        </div>
        <div class="pointer admin_menu_item">
            <img src="./icons/plus-icon.svg" alt="">
            <h5>New Template</h5>
        </div>
        <div class="pointer admin_menu_item">
            <img src="./icons/male-icon.svg" alt="">
            <h5>Users</h5>
        </div>
    </div>
    <div class="main">
        <div class="basic_list">
            <h3>Templates</h3>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
        </div>
        <div class="basic_list">
            <h3>User lists</h3>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
        </div>
    </div>
    <div class="main">
        <div class="template_action">
            <div>
                <input placeholder="Your Title for your Template" type="text">
            </div>
            <div class="pointer template_btn">
                <img src="./icons/close-square-icon.svg" alt="">
                <h5>Delete</h5>
            </div>
            <div class="pointer template_btn">
                <img src="./icons/plus-icon.svg" alt="">
                <h5>Title Image</h5>
            </div>
            <div class="pointer template_btn">
                <img src="./icons/pencil-icon.svg" alt="">
                <h5>Save</h5>
            </div>
        </div>
        <div class="template_board">
            <h3>Tiers</h3>
            <div class="template_board_tiers">
                <h5 class="drag">Best</h5>
                <h5 class="drag">Good</h5>
                <h5 class="drag">Averageeeeeeeeee</h5>
                <h5 class="drag">Bad</h5>
                <h5 class="drag">Worst</h5>
                <h5 class="drag">Best</h5>
                <h5 class="drag">Good</h5>
                <h5 class="drag">Average</h5>
                <h5 class="drag">Bad</h5>
                <h5 class="drag">Worst</h5>
                <h5 class="drag">Best</h5>
                <h5 class="drag">Good</h5>
                <h5 class="drag">Average</h5>
                <h5 class="drag">Bad</h5>
                <h5 class="drag">Worst</h5>
            </div>
            <img class="tier_plus_icon pointer" src="./icons/plus-icon.svg" alt="">
            <div class="template_board_images" ondrop="">
                <h3>Images</h3>
                <div class="pointer board_img">
                    <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                </div>
                <div class="pointer board_img">
                    <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                </div>
                <div class="pointer board_img">
                    <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                </div>
                <div class="pointer board_img">
                    <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                </div>
                <div class="pointer board_img">
                    <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                </div>
            </div>
            <img class="tier_plus_icon pointer" src="./icons/plus-icon.svg" alt="">
        </div>
    </div>
    <div class="main">
        <div class="tierlist_from_temp">
            <div class="tierlist_action">
                <div>
                    <h3>Template Title -</h3>
                    <input placeholder="Your Title for your Template" type="text">
                </div>
                <div class="pointer template_btn">
                    <img src="./icons/close-square-icon.svg" alt="">
                    <h5>Delete</h5>
                </div>
                <div class="pointer template_btn">
                    <img src="./icons/pencil-icon.svg" alt="">
                    <h5>Save</h5>
                </div>
            </div>
            <div class="tierlist_board template_board">
                <div class="template_board_tiers">
                    <div class="tier_level">
                        <h5>Average</h5>
                        <div class="pointer tier_level_img">
                            <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                        </div>
                    </div>
                    <div class="tier_level">
                        <h5>Average</h5>
                    </div>
                    <div class="tier_level">
                        <h5>Average</h5>
                        <div class="pointer tier_level_img">
                            <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                        </div>
                        <div class="pointer tier_level_img">
                            <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                        </div>
                        <div class="pointer tier_level_img">
                            <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                        </div>
                        <div class="pointer tier_level_img">
                            <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                        </div>
                        <div class="pointer tier_level_img">
                            <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                        </div>
                    </div>
                    <div class="tier_level">
                        <h5>Average</h5>
                        <div class="pointer tier_level_img">
                            <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                        </div>
                        <div class="pointer tier_level_img">
                            <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                        </div>
                        <div class="pointer tier_level_img">
                            <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                        </div>
                    </div>
                    <div class="tier_level">
                        <h5>Average</h5>
                        <div class="pointer tier_level_img">
                            <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="tier_images">
                    <div class="pointer board_img">
                        <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                    </div>
                    <div class="pointer board_img">
                        <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                    </div>
                    <div class="pointer board_img">
                        <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                    </div>
                    <div class="pointer board_img">
                        <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                    </div>
                    <div class="pointer board_img">
                        <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                    </div>
                    <div class="pointer board_img">
                        <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                    </div>
                    <div class="pointer board_img">
                        <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                    </div>
                    <div class="pointer board_img">
                        <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                    </div>
                    <div class="pointer board_img">
                        <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="main">
        <div class="admin_userlist">
            <div class="user_card">
                <img class="user_img" src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                <div class="user_info">
                    <h5>Username</h5>
                    <h5>UserEmail@email.com</h5>
                </div>
                <div class="pointer user_btn">
                    <img src="./icons/pencil-icon.svg" alt="">
                    <h5>Edit User</h5>
                </div>
                <div class="pointer user_btn">
                    <img src="./icons/close-square-icon.svg" alt="">
                    <h5>Delete User</h5>
                </div>
            </div>
            <div class="user_card">
                <img class="user_img" src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                <div class="user_info">
                    <h5>Username</h5>
                    <h5>UserEmail@email.com</h5>
                </div>
                <div class="pointer user_btn">
                    <img src="./icons/pencil-icon.svg" alt="">
                    <h5>Edit User</h5>
                </div>
                <div class="pointer user_btn">
                    <img src="./icons/close-square-icon.svg" alt="">
                    <h5>Delete User</h5>
                </div>
            </div>
            <div class="user_card">
                <img class="user_img" src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                <div class="user_info">
                    <h5>Username</h5>
                    <h5>UserEmail@email.com</h5>
                </div>
                <div class="pointer user_btn">
                    <img src="./icons/pencil-icon.svg" alt="">
                    <h5>Edit User</h5>
                </div>
                <div class="pointer user_btn">
                    <img src="./icons/close-square-icon.svg" alt="">
                    <h5>Delete User</h5>
                </div>
            </div>
            <div class="user_card">
                <img class="user_img" src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                <div class="user_info">
                    <h5>Username</h5>
                    <h5>UserEmail@email.com</h5>
                </div>
                <div class="pointer user_btn">
                    <img src="./icons/pencil-icon.svg" alt="">
                    <h5>Edit User</h5>
                </div>
                <div class="pointer user_btn">
                    <img src="./icons/close-square-icon.svg" alt="">
                    <h5>Delete User</h5>
                </div>
            </div>
            <div class="user_card">
                <img class="user_img" src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                <div class="user_info">
                    <h5>Username</h5>
                    <h5>UserEmail@email.com</h5>
                </div>
                <div class="pointer user_btn">
                    <img src="./icons/pencil-icon.svg" alt="">
                    <h5>Edit User</h5>
                </div>
                <div class="pointer user_btn">
                    <img src="./icons/close-square-icon.svg" alt="">
                    <h5>Delete User</h5>
                </div>
            </div>
            <div class="user_card">
                <img class="user_img" src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="">
                <div class="user_info">
                    <h5>Username</h5>
                    <h5>UserEmail@email.com</h5>
                </div>
                <div class="user_btn">
                    <img src="./icons/pencil-icon.svg" alt="">
                    <h5>Edit User</h5>
                </div>
                <div class="user_btn">
                    <img src="./icons/close-square-icon.svg" alt="">
                    <h5>Delete User</h5>
                </div>
            </div>
        </div>
    </div>
    <div class="main">
        <div class="profile_card">
            <h5 class="profile_title">My Profile</h5>
            <img class="profile_img" src="./icons/male-icon.svg" alt="">
            <div class="profile_info">
                <input placeholder="Admin - Super" type="text">
                <input placeholder="admin@admin.com" type="text">
                <input placeholder="password" type="text">
                <div class="pointer profile_btn">
                    <img src="./icons/pencil-icon.svg" alt="">
                    <h5>Edit</h5>
                </div>
                <div class="pointer profile_btn">
                    <img src="./icons/close-square-icon.svg" alt="">
                    <h5>Delete</h5>
                </div>
            </div>
            <div class="profile_sessions">
                <h5>User Session</h5>
                <div class="session_card">
                    <div class="session_ip">
                        <img src="./icons/monitor-icon.svg" alt="">
                        <h5>192.168.1.1</h5>
                    </div>
                    <div class="session_out">
                        <img class="pointer" src="./icons/door-check-out-icon.svg" alt=""></div>
                </div>
                <div class="session_card">
                    <div class="session_ip">
                        <img src="./icons/monitor-icon.svg" alt="">
                        <h5>192.168.1.1</h5>
                    </div>
                    <div class="session_out">
                        <img class="pointer" src="./icons/door-check-out-icon.svg" alt=""></div>
                </div>
                <div class="session_card">
                    <div class="session_ip">
                        <img src="./icons/monitor-icon.svg" alt="">
                        <h5>192.168.1.1</h5>
                    </div>
                    <div class="session_out">
                        <img class="pointer" src="./icons/door-check-out-icon.svg" alt=""></div>
                </div>
            </div>
        </div>
        <div class="basic_list">
            <h3>Tierlists</h3>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
            <div class="pointer list_item">
                <img src="./imgs/c2c9362d-eb52-47ce-a0df-ae58b0e40ae3.png" alt="" class="list_item_img">
                <h5 class="list_item_title">Test Item</h5>
            </div>
        </div>
    </div>
    <div class="main">
        <div class="login_card">
            <h3 class="login_title">Register</h3>
            <div class="login_img">
                <img src="./icons/male-icon.svg" alt="">
                <h5 class="pointer">Add Photo</h5>
            </div>
            <div class="login_info">
                <input placeholder="Username" type="text">
                <input placeholder="Email " type="text">
                <input placeholder="Password" type="text">
                <input placeholder="Repeat Password" type="text">
                <h5 class="pointer">Register</h5>
            </div>
        </div>
    </div>
    <footer>
        <img src="./icons/alphabet-c-icon.svg" alt="" class="footer_icon">
        <h5 class="footer_text pointer" href="https://www.instagram.com/nikos.kal_/">Designed & Developed By Nikos.kal_</h5>
    </footer>
    <script>


document.getElementsByTagName("body")[0].style.cursor = "url('./icons/pointer-arrow-icon.svg'), auto";

    var clickable = document.getElementsByClassName("pointer");
    var draggable = document.getElementsByClassName("drag");
    var body_box = document.getElementsByClassName("body");
    var main_box = document.getElementsByClassName("main");
    var temp_board_tiers_box_box = document.getElementsByClassName("template_board_tiers");
    var main_rect = main_box[1].getBoundingClientRect();//##########TOCHANGELAITER
    var body_rect = body_box[0].getBoundingClientRect();
    var tier_box_rect = temp_board_tiers_box_box[0].getBoundingClientRect();




////////////////////////////////////////////// BOUNDING BOX UPDATE WITH SCROLL


document.addEventListener("scroll", (event) => {
    lastKnownScrollPosition = window.scrollY;
    // console.log(lastKnownScrollPosition);
    setTimeout(upd_ELM(), 10);
    });


    // document.addEventListener('mousemove', (elm) => {
    //     console.log(event.clientX+"   CLIENT X");
    //     console.log(event.clientY+"   CLIENT Y");
    // });





var green_val = [];
var red_val = [];
var done_j = 0;
var boundingclient_arr=[];
var dropto=-1;
var dragging_elm = -1;
var top_old='';
var left_old='';
var drop_pos=-1;
var elm_matrix=[];
var init_transf=0;
var dropped_shadow=0;
var tier_level_rows=[];
var svg_insert='';
var id_list=[];
var rebound_arr=0;
var pointer_start_x='';
var pointer_start_y='';
var first_row_elm_width=[];
var button_sum_width=0;
var bounding_arr_changed=[];
BG_coloring();
eventListenerInit();



for(var i = 0; i < draggable.length; i++) {
    if(boundingclient_arr[i].top == boundingclient_arr[0].top){
        first_row_elm_width.push(6+boundingclient_arr[i].width+6);
        button_sum_width= 6+button_sum_width+boundingclient_arr[i].width+6;
    }
}



console.log(first_row_elm_width);
console.log(button_sum_width-12);
console.log(tier_box_rect.width);
console.log(parseFloat(window.getComputedStyle(draggable[0], null).getPropertyValue('width')));
console.log(boundingclient_arr[0].width)



////////////////////////////////////////////// COLOR GENERATION
function BG_coloring(){

if ((draggable.length%2)=== 0){
        for(var i = 1; i < ((draggable.length)/2)+1; i++) {
            green_val[i] = 130 * ((1/(draggable.length/2))*i);
        }
        for(var j = (draggable.length/2); j > 0; j--) {
            red_val[j]=130 * ((1/(draggable.length/2))*j);
        }
        
      }else{

        for(var i = 1; i < ((draggable.length)/2)+1; i++) {
            green_val[i] = Math.ceil(130 * ((1/(draggable.length/2))*i));
            // console.log(green_val[i]+" I LOOP "+i);
        }
        for(var j = Math.ceil((draggable.length/2)-1); j > 0; j--) {
            red_val[j]=Math.ceil(130 * ((1/(draggable.length/2))*j));
        }
        green_val[i] = 255 / (draggable.length-1);
        red_val[i]=255 / (draggable.length-1);
      }
///////////////////// COLOR ASSIGNMENT TO BACKGROUND OF TIER LEVELS
for(var i = 0; i < draggable.length; i++) {
    draggable[ i ].style.setProperty("--pseudo-text", `"${i+1}"`);
    
    if(draggable.length%2===0){
        if(i<(draggable.length/2)){
                // console.log(i+"TEST TO CSS LOOP 1 "+Math.round(green_val[(draggable.length/2)-i]));
                draggable[i].style.setProperty("background-color", `rgb(20,${Math.round(green_val[(draggable.length/2)-i])},20)`);
            }else{
                // console.log(i+"TEST TO CSS"+Math.round(Math.round(red_val[i-(green_val.length-2)])));
                draggable[i].style.setProperty("background-color", `rgb(${Math.round(red_val[i-(green_val.length-2)])},20,20)`);
            }
    }else{
        if(i<(draggable.length/2)){
                // console.log(i+" TEST TO CSS LOOP 1 "+green_val[Math.floor(draggable.length/2)-(i-1)]);
                draggable[i].style.setProperty("background-color", `rgb(20,${green_val[Math.floor(draggable.length/2)-(i-1)]},20)`);
            }else{
                // console.log(i+" TEST TO CSS "+red_val[i-(green_val.length-3)]);
                draggable[i].style.setProperty("background-color", `rgb(${red_val[i-(green_val.length-3)]},20,20)`);
            }
    }
}

}


function eventListenerInit(){
    for(var i = 0; i < draggable.length; i++) {
/////////////////////////////////////////////DRAG

    boundingclient_arr[i] = draggable[i].getBoundingClientRect();

    /////////////////////// TIER LEVEL ROW CALC
    
    if(tier_level_rows.indexOf(boundingclient_arr[i].y)==-1){
        tier_level_rows.push(boundingclient_arr[i].y)
    }

    // console.log(tier_level_rows);



    /////////////////////// TIER EVENT LISTENERS


    temp_board_tiers_box_box[0].addEventListener('mousemove', (elm) => {
        // document.getElementsByTagName("body")[0].style.cursor = "url('./icons/cursor-hand-icon.svg'), auto";
        if(dragging_elm>=0){
            move(draggable[dragging_elm],dragging_elm);
            dragoveranim(boundingclient_arr,dragging_elm);
        }

    });
    draggable[i].addEventListener('mousedown', (elm) => {
        document.getElementsByTagName("body")[0].style.cursor = "url('./icons/cursor-hand-grab-icon.svg'), auto";
        elm.target.setAttribute("id", "moving");
        pointer_start_x=event.clientX;
        pointer_start_y=event.clientY;
        elm.target.style.zIndex='2';
        for(var i = 0; i < draggable.length; i++) {
            id_list[i] = draggable[i].getAttribute("id");
        }


        dragging_elm = id_list.findIndex((x) => x === 'moving');


        for(var i = 0; i < draggable.length; i++) {

            // if((i!=dragging_elm) && (boundingclient_arr[i].top != bounding_arr_changed[i].top)){
            //     console.log(bounding_arr_changed[i]);
            //     console.log("THIS IS "+i+"  NUM");
            // }

            draggable[i].style.transition=`0s`;
            if((boundingclient_arr[dragging_elm]!=boundingclient_arr[i])&&(boundingclient_arr[dragging_elm].top<=boundingclient_arr[i].top)&&(boundingclient_arr[dragging_elm].bottom>=boundingclient_arr[i].bottom)){
                if(boundingclient_arr[i].x<event.clientX - (boundingclient_arr[dragging_elm].width/2)){
                    draggable[i].style.left = `-${(boundingclient_arr[dragging_elm].width/2)+6}px`;
                }else if(boundingclient_arr[i].x>event.clientX - (boundingclient_arr[dragging_elm].width/2)){
                    draggable[i].style.left = `${(boundingclient_arr[dragging_elm].width/2)+6}px`;
                }else{

                }
            }
        }

        move(draggable[dragging_elm],dragging_elm);
        dragoveranim(boundingclient_arr,dragging_elm);



    });
    draggable[i].addEventListener('mouseover', (elm) => {
        document.getElementsByTagName("body")[0].style.cursor = "url('./icons/cursor-hand-icon.svg'), auto";
        // elm.target.style.pointerEvents = 'all';

    });
    draggable[i].addEventListener('mouseup', (elm) => {
        document.getElementsByTagName("body")[0].style.cursor = "url('./icons/cursor-hand-icon.svg'), auto";
        setTimeout(function(boundingclient_arr,dragging_elm){drop_start(boundingclient_arr,dragging_elm);},20,boundingclient_arr,dragging_elm);

        if(drop_pos!=-1){
            elm.target.style.transition=`all .3s`;
            elm.target.style.transform=`scale(1)`;
            elm.target.style.top  = `${boundingclient_arr[dragging_elm].y-tier_box_rect.y-6}px`;
            elm.target.style.left =`${boundingclient_arr[dragging_elm].x-tier_box_rect.x}px`;
            setTimeout(function(event,elm,dragging_elm,boundingclient_arr){drop_end(event,elm,dragging_elm,boundingclient_arr)},300,event,elm,dragging_elm,boundingclient_arr);
        }else{
            elm.target.style.transition=`all .3s`;
            elm.target.style.transform=`scale(1)`;
            elm.target.style.top  = `${boundingclient_arr[dragging_elm].y-tier_box_rect.y-6}px`;
            elm.target.style.left =`${boundingclient_arr[dragging_elm].x-tier_box_rect.x}px`;
            setTimeout(function(event,elm,dragging_elm,boundingclient_arr){drop_end(event,elm,dragging_elm,boundingclient_arr)},300,event,elm,dragging_elm,boundingclient_arr);
        }       

        elm.target.removeAttribute("id", "moving");

    });
    draggable[i].addEventListener('mouseleave', (elm) => {
        document.getElementsByTagName("body")[0].style.cursor = "url('./icons/pointer-arrow-icon.svg'), auto";
        if(dragging_elm!=-1 && draggable[dragging_elm]== elm.target){
            setTimeout(function(boundingclient_arr,dragging_elm){drop_start(boundingclient_arr,dragging_elm);},20,boundingclient_arr,dragging_elm);
            elm.target.style.transition=`all .3s`;
            elm.target.style.top  = `${boundingclient_arr[dragging_elm].y-tier_box_rect.y-6}px`;
            elm.target.style.left =`${boundingclient_arr[dragging_elm].x-tier_box_rect.x}px`;
            setTimeout(function(event,elm,dragging_elm,boundingclient_arr){drop_end(event,elm,dragging_elm,boundingclient_arr)},300,event,elm,dragging_elm,boundingclient_arr);
        }

    });

    draggable[i].addEventListener("dragstart", function(e) {
        document.getElementsByTagName("body")[0].style.cursor = "url('./icons/cursor-hand-grab-icon.svg'), auto";
        var img = document.createElement("img");
        img.src = "";
        e.dataTransfer.setDragImage(img, 0, 0);
    }, false);
};
}

function upd_ELM(){
    console.log("--------------------------UPDATING EVERYTHING----------------")

    document.getElementsByTagName("body")[0].style.cursor = "url('./icons/pointer-arrow-icon.svg'), auto";

    clickable = document.getElementsByClassName("pointer");
    draggable = document.getElementsByClassName("drag");

    body_box = document.getElementsByClassName("body");
    main_box = document.getElementsByClassName("main");
    temp_board_tiers_box_box = document.getElementsByClassName("template_board");
    main_rect = main_box[1].getBoundingClientRect();//##########TOCHANGELAITER
    body_rect = body_box[0].getBoundingClientRect();
    tier_box_rect = temp_board_tiers_box_box[0].getBoundingClientRect();


    green_val = [];
    red_val = [];
    done_j = 0;
    boundingclient_arr=[];
    dropto=-1;
    dragging_elm = -1;
    top_old='';
    left_old='';
    drop_pos=-1;
    elm_matrix=[];
    init_transf=0;
    dropped_shadow=0;
    tier_level_rows=[];
    svg_insert='';
    id_list=[];
    rebound_arr=0;
    pointer_start_x='';
    pointer_start_y='';
    first_row_elm_width=[];
    button_sum_width=0;
    bounding_arr_changed=[];

   

    for(var i = 0; i < draggable.length; i++) {
        boundingclient_arr[i] = draggable[i].getBoundingClientRect();
    }

    // BG_coloring();
    // eventListenerInit();
}

function move(element,i) {
    if(document.getElementById('moving')){
        element.style.transition = `left 0s, top 0s, transform .3s`;
        element.style.position = `absolute`;
        // element.style.top =boundingclient_arr[i].y - tier_box_rect.y-5 +"px";
        // element.style.left =boundingclient_arr[i].x - tier_box_rect.x+5  +"px";
        document.getElementsByTagName("body")[0].style.cursor = "url('./icons/cursor-hand-grab-icon.svg'), auto";
        element.style.top =boundingclient_arr[i].y - tier_box_rect.y-5 +(event.clientY-pointer_start_y) +"px";
        element.style.left =boundingclient_arr[i].x - tier_box_rect.x+5 +(event.clientX-pointer_start_x) +"px";
    }

}

function dragoveranim(bounding_arr,i){

    for(var j = 0; j < draggable.length; j++) {
        if(j!=i){
            bounding_arr_changed[j] = draggable[j].getBoundingClientRect();
        }else{
            bounding_arr_changed[j]=bounding_arr[i];
        }
    }
    

    
for(var j = 0; j < draggable.length; j++) {
    draggable[j].style.transition=`.3s`;
    if((bounding_arr_changed[j]) && (event.clientY<bounding_arr_changed[j].top+bounding_arr_changed[j].height) && event.clientY>bounding_arr_changed[j].top){
        if(bounding_arr_changed[j].x<event.clientX - (bounding_arr[i].width/2) && bounding_arr_changed[j]!=bounding_arr[i]){
            draggable[j].style.setProperty("background-color","blue");
            // draggable[j].style.left = `-${(bounding_arr[i].width/3)+6}px`;
            // draggable[j].style.left='-10px';
            draggable[j].style.left='0px';
            if(j<i){
                dropto=j+1;
            }else{
                dropto=j;
            }
        }else if(bounding_arr_changed[j].x>event.clientX - (bounding_arr[i].width/2) && bounding_arr_changed[j]!=bounding_arr[i]){

            if(dropto==-1){
                dropto=j-1;
            }
            draggable[j].style.left='0px';
            // draggable[j].style.left = `${(bounding_arr[i].width/3)+6}px`;
            // draggable[j].style.left='10px';
            if(bounding_arr[j].top != bounding_arr_changed[j].top){
                draggable[j].style.setProperty("background-color","cyan");
            }else{
                draggable[j].style.setProperty("background-color","green");

            }


        }else{
            
            if(dropto==-1){dropto=j-1;};
            if(j!=i){
                // if(j<i){
                //     draggable[j].style.setProperty("background-color","blue");
                // }else{
                    // draggable[j].style.setProperty("background-color","green");
                // }
            }else{
                draggable[j].style.setProperty("background-color","orange");
            }
        }
    }else{
        if(j!=i && draggable[j]){
            draggable[j].style.left=`0px`;
            draggable[j].style.setProperty("background-color","red");
        }else{
            draggable[j].style.setProperty("background-color","orange");
        }

    }
}

    drop_pos = dropto;
    dropto=-1;

    if(drop_pos!=-1){
        // draggable[i].style.transform='scale(0.9)';
    }else{
        // draggable[i].style.transform='scale(1.1)';
    }
    // console.log(drop_pos);
}

function drop_start(bounding_arr,i){
    // console.log(draggable[2].getBoundingClientRect());
    // console.log(draggable[3].getBoundingClientRect());
    // var tr = window.getComputedStyle(draggable[3]).transform
    // const matrix = tr.match(/matrix\(([^)]+)\)/)[1].split(", ");
    // scaleY = parseFloat(matrix[3]);
    // console.log(draggable[3].getBoundingClientRect().height-(draggable[3].getBoundingClientRect().height*(scaleY/10)));
    // console.log(scaleY);
    // console.log(draggable[3].getBoundingClientRect().height-draggable[3].offsetHeight*(scaleY/10));
    // ####################################################  PROBLEM WITH WRONG BOUNDING BOX
    // ####################################################  LEFT AND TOP WHEN DRAGGING ELEMENT CHANGING SCALE

    
    for(var j = 0; j < draggable.length; j++) {
        // console.log("ELEMENT          "+j)
        if((bounding_arr[i]!=bounding_arr[j])&&(bounding_arr[i].top<=bounding_arr[j].top)&&(bounding_arr[i].bottom>=bounding_arr[j].bottom)){

            console.log("DROP_STARTTTTTTTTT   "+j);
            if(j!=i && j<i){
                draggable[j].style.transition = `left .3s`;
                draggable[j].style.left = `-${(bounding_arr[i].width/2)+6}px`;
                
            }else if(j!=i && j>i){
                draggable[j].style.transition = `left .3s`;
                draggable[j].style.left = `${(bounding_arr[i].width/2)+6}px`;
            }else{
                // console.log(j);
                // console.log(bounding_arr);
                // draggable[i].style.transition = `all 0.3s`;
            }
        }
    }

}

function drop_end(event,elm,dragging_elm,bounding_arr){


                    elm.target.style.transition=`left 0s, top 0s, transform .3s`;
                    elm.target.style.position='relative';
                    elm.target.style.top  = "0px";
                    elm.target.style.left ="0px";


                    for(var j = 0; j < draggable.length; j++) {
                        if((bounding_arr[dragging_elm]!=bounding_arr[j])&&(bounding_arr[dragging_elm].top<=bounding_arr[j].top)&&(bounding_arr[dragging_elm].bottom>=bounding_arr[j].bottom)){
                            if(j!=dragging_elm && j<dragging_elm){
                                draggable[j].style.transition = `0s`;
                                draggable[j].style.left = `0px`;
                            }else if(j!=dragging_elm && j>dragging_elm){
                                draggable[j].style.transition = `0s`;
                                draggable[j].style.left = `0px`;
                            }else{
                                

                            }
                           
                        }

                    }
                    setTimeout(function(elm){
                    elm.target.style.transition=`all .3s`;
                    elm.target.style.transform=`scale(1)`; 
                    upd_ELM();
                    },10,elm);



}


//  ##############################HOVER

 for(var i = 0; i < clickable.length; i++) {
    clickable[i].addEventListener('mouseover', () => {
    document.getElementsByTagName("body")[0].style.cursor = "url('./icons/cursor-hand-icon.svg'), auto";
  });
  clickable[i].addEventListener('mouseleave', () => {
    document.getElementsByTagName("body")[0].style.cursor = "url('./icons/pointer-arrow-icon.svg'), auto";
  });
};


    </script>
</body>
</html>